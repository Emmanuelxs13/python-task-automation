"""
Vulnerability model for security findings
Stores individual security vulnerabilities found during scans
"""

from sqlalchemy import Column, Integer, String, Text, ForeignKey, Enum as SQLEnum
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from sqlalchemy import DateTime
import enum

from app.core.database import Base


class Severity(str, enum.Enum):
    """Vulnerability severity levels"""
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"
    INFO = "info"


class Vulnerability(Base):
    """
    Vulnerability model representing a security finding

    Attributes:
        id: Unique vulnerability identifier
        scan_id: ID of the scan that found this vulnerability
        severity: Severity level of the vulnerability
        title: Short title describing the vulnerability
        description: Detailed description of the issue
        recommendation: How to fix the vulnerability
        created_at: Timestamp when vulnerability was detected
    """
    __tablename__ = "vulnerabilities"

    id = Column(Integer, primary_key=True, index=True)
    scan_id = Column(Integer, ForeignKey(
        "scans.id", ondelete="CASCADE"), nullable=False)
    severity = Column(SQLEnum(Severity), nullable=False)
    title = Column(String(200), nullable=False)
    description = Column(Text, nullable=False)
    recommendation = Column(Text, nullable=True)
    created_at = Column(DateTime(timezone=True),
                        server_default=func.now(), nullable=False)

    # Relationships
    scan = relationship("Scan", back_populates="vulnerabilities")
